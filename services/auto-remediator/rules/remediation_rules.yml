defaults:
  source: auto_remediator
  severity: warn
  cooldown_sec: 180

# Normalize service names into a canonical set used by dashboards/rules.
# Keys and values are treated case-insensitively and normalized to lowercase.
service_aliases:
  payment-service: payments
  payments-service: payments
  auth-service: auth
  db-service: db
  orders-service: orders

# Optional policy guards
policy:
  # Only allow remediation for the core demo services
  allowlist_services:
    - payments
    - auth
    - db
    - orders

  # Always block these targets.
  denylist_services:
    - unknown

  # Optional: restrict to supported action types.
  allowlist_action_types:
    - SCALE_UP
    - ROLLING_RESTART

rules:
  - rule_id: cpu_spike_scale_up
    incident_type: CPU_SPIKE
    min_severity: warn
    pattern: "*"
    action_type: SCALE_UP
    target_service: "{service}"
    parameters:
      replicas_delta: 1
      reason: "cpu spike"
    cooldown_sec: 120

  - rule_id: latency_spike_scale_up
    incident_type: LATENCY_SPIKE
    min_severity: warn
    pattern: "*"
    action_type: SCALE_UP
    target_service: "{service}"
    parameters:
      replicas_delta: 1
      reason: "latency spike"
    cooldown_sec: 120

  - rule_id: error_rate_rolling_restart
    incident_type: ERROR_RATE_SPIKE
    min_severity: error
    pattern: "*"
    action_type: ROLLING_RESTART
    target_service: "{service}"
    parameters:
      reason: "error rate spike"
    cooldown_sec: 180

  - rule_id: memory_spike_restart
    incident_type: MEMORY_SPIKE
    min_severity: warn
    pattern: "*"
    action_type: ROLLING_RESTART
    target_service: "{service}"
    parameters:
      reason: "memory spike"
    cooldown_sec: 300
